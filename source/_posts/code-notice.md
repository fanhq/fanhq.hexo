---
title: 常用编码规则
date: 2019-04-15 17:25:31
tags:
    - java
---
### java编码规范

+ 常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。  
正例：MAX_STOCK_COUNT  
反例：MAX_COUNT

+ 抽象类命名使用Abstract或Base开头；异常类命名使用Exception结尾；测试类命名以它要测试的类的名称开始，以Test结尾

+ POJO类中布尔类型的变量，都不要加is前缀，否则部分框架解析会引起序列化错误。 反例：定义为基本数据类型Boolean isDeleted的属性，它的方法也是isDeleted()，RPC框架在反向解析的时候，“误以为”对应的属性名称是deleted，导致属性获取不到，进而抛出异常

+ 接口类中的方法和属性不要加任何修饰符号（public 也不要加），保持代码的简洁性，并加上有效的Javadoc注释。尽量不要在接口里定义变量，如果一定要定义变量，肯定是与接口方法相关，并且是整个应用的基础常量

+ 对于Service和DAO类，基于SOA的理念，暴露出来的服务一定是接口，内部的实现类用Impl的后缀与接口区别。   
正例：CacheServiceImpl实现CacheService接口
<!-- more -->
+ 如果是形容能力的接口名称，取对应的形容词为接口名（通常是–able的形式）。   
正例：AbstractTranslator实现 Translatable接口

+ 在long或者Long赋值时，数值后使用大写的L，不能是小写的l，小写容易跟数字1混淆，造成误解

+ 关于基本数据类型与包装数据类型的使用标准如下：   
1） 【强制】所有的POJO类属性必须使用包装数据类型。   
2） 【强制】RPC方法的返回值和参数必须使用包装数据类型。   
3） 【推荐】所有的局部变量使用基本数据类型。   
说明：
    POJO类属性没有初值是提醒使用者在需要使用时，必须自己显式地进行赋值，任何NPE问题，或者入库检查，都由使用者来保证。    
    正例：数据库的查询结果可能是null，因为自动拆箱，用基本数据类型接收有NPE风险。   
    反例：比如显示成交总额涨跌情况，即正负x%，x为基本数据类型，调用的RPC服务，调用不成功时，返回的是默认值，页面显示为0%，这是不合理的，应该显示成中划线。所以包装数据类型的null值，能够表示额外的信息，如：远程调用失败，异常退出

+ 类内方法定义的顺序依次是：公有方法或保护方法 > 私有方法 > getter/setter方法

+ final可以声明类、成员变量、方法、以及本地变量，下列情况使用final关键字：  
    1） 不允许被继承的类，如：String类。  
    2） 不允许修改引用的域对象。   
    3） 不允许被重写的方法，如：POJO类的setter方法。  
    4） 不允许运行过程中重新赋值的局部变量。  
    5） 避免上下文重复使用一个变量，使用final描述可以强制重新定义一个变量，方便更好地进行重构

+ volatile解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题（同时写有问题）

+ ThreadLocal无法解决共享对象的更新问题，ThreadLocal对象建议使用static修饰

+ 下列情形，需要进行参数校验： 
1） 调用频次低的方法。   
2） 执行时间开销很大的方法。  
3） 需要极高稳定性和可用性的方法。   
4） 对外提供的开放接口，不管是RPC/API/HTTP接口。  
5） 敏感权限入口。

+ 下列情形，不需要进行参数校验： 
1） 极有可能被循环调用的方法。但在方法说明里必须注明外部参数检查要求。   
2） 底层调用频度比较高的方法。毕竟是像纯净水过滤的最后一道，参数错误不太可能到底层才会暴露问题。一般DAO层与Service层都在同一个应用中，部署在同一台服务器中，所以DAO的参数校验，可以省略。   
3） 被声明成private只会被自己代码所调用的方法，如果能够确定调用方法的代码传入参数已经做过检查或者肯定不会有问题，此时可以不校验参数。

+ 防止NPE，是程序员的基本修养，注意NPE产生的场景：   
1）返回类型为基本数据类型，return包装数据类型的对象时，自动拆箱有可能产生NPE。   
2） 数据库的查询结果可能为null。   
3） 集合里的元素即使isNotEmpty，取出的数据元素也可能为null。   
4） 远程调用返回对象时，一律要求进行空指针判断，防止NPE。   
5） 对于Session中获取的数据，建议NPE检查，避免空指针。   
6） 级联调用obj.getA().getB().getC()；一连串调用，易产生NPE。  

+ 给JVM环境参数设置-XX:+HeapDumpOnOutOfMemoryError参数，让JVM碰到OOM场景时输出dump信

+ 在线上生产环境，JVM的Xms和Xmx设置一样大小的内存容量，避免在GC 后调整堆大小带来的压力

### mysql

+ 主键索引名为pk_字段名；唯一索引名为uk_字段名；普通索引名则为idx_字段名

+ 小数类型为decimal，禁止使用float和double

+ 表必备三字段：id, gmt_create, gmt_modified
说明： 其中 id必为 主键，类型必为 主键，类型bigint unsigned、单表时自增步长为 、单表时自增步长为 1。gmt_create, gmt_modified的类型均为 的类型均为 datetime类型，前者现在时表示主动创建后过去分词被 类型，前者现在时表示主动创建后过去分词被动更新

+ 单表行数超过500万行或者单表容量超过2GB，才推荐进行分库分表

+ 防止因字段类型不同造成的隐式转换，导致索引失效

+ 不要使用count(列名)或count(常量)来替代count(*)

+ in操作能避免则避免，若实在避免不了，需要仔细评估in后边的集合元素数量，控制在1000个之内

+ 在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明

+ POJO类的布尔属性不能加is，而数据库字段必须加is_，要求在resultMap中进行字段与属性之间的映射
